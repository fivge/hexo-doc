---
title: Linux2.2.3数据流重定向
tags:
- shell
- Linux
date: 2016-10-26 14:26:03
---

`>`	将标准输出导向一个文件    
`>>`	将标准输出追加到一个文件中    

## 1.简单的重定向

Linux默认提供了三个特殊设备，用于终端的显示和输出，分别为stdin(标准输入,对应于你在终端的输入)，stdout（标准输出，对应于终端的输出），stderr(标准错误输出，对应于终端的输出)。

| 文件描述符 | 设备文件        | 说明   |
| ----- | ----------- | ---- |
| 0     | /dev/stdin  | 标准输入 |
| 1     | /dev/stdout | 标准输出 |
| 2     | /dev/stderr | 标准错误 |

<!-- more -->

文件描述符**：文件描述符在形式上是一个非负整数。实际上，它是一个索引值，指向内核为每一个进程所维护的该进程打开文件的记录表。当程序打开一个现有文件或者创建一个新文件时，内核向进程返回一个文件描述符。在程序设计中，一些涉及底层的程序编写往往会围绕着文件描述符展开。但是文件描述符这一概念往往只适用于UNIX、Linux这样的操作系统。
另外还有一个符号-,它可以同时作为前一个命令的

我们可以这样使用这些文件描述符

默认使用终端的标准输入作为命令的输入和标准输出作为命令的输出

```shell
cat 
```
将一个文件作为命令的输入，标准输出作为命令的输出

```shell
cat file1
```
将echo命令通过管道传过来的数据作为cat命令的输入，将标准输出作为命令的输出

```shell
echo 'hi' | cat
```
将echo命令的输出从默认的标准输出重定向到一个普通文件

```shell
echo 'love you' > file
cat file
```
## 2.标准错误重定向

使用cat 命令同时读取两个文件，其中file1存在，file2不存在

```shell
cat file1 file2
```
你可以看到除了正确输出了前一个文件的内容，还在末尾出现了一条错误信息

下面我们将输出重定向到一个文件，根据我们前面的经验，这里将在看不到任何输出了

```shell
cat file1 file2 > file
```


遗憾的是，这里依然出现了那条错误信息，这正是因为如我上面说的那样，标准输出和标准错误虽然都指向终端屏幕，实际它们并不一样。那有的时候我们就是要可以隐藏某些错误或者警告，那又该怎么做呢。这就需要用到我们前面讲的文件描述符了

将标准错误重定向到标准输出，再将标准输出重定向到文件，注意要将重定向到文件写到前面

```shell
cat file1 file2 > file  2>&1
```
或者只用bash提供的特殊的重定向符号`"&"`将标准错误和标准输出同时重定向到文件

```shell
cat file1 file2 &> file
```
## 3.使用tee命令同时重定向到多个文件

将输出重定向到文件之外也将信息打印在终端

```shell
echo 'hello world' | tee file
```

## 4.永久重定向
使用`exec`命令实现“永久”重定向    

```shell
exec 1>file
```
后面你执行的命令的输出都将被重定向到文件中,直到你退出当前子shell，或取消exec的重定向

## 5.创建输出文件描述符

默认在shell中可以有9个打开的文件描述符，上面我们使用了也是它默认提供的0,1,2号文件描述符，另外我们还可以使用3-8的文件描述符，只是它们默认没有打开而已，你可以使用下面命令查看当前shell进程中打开的文件描述符

```shell
cd /dev/fd/
ls -Al
```
同样使用exec命令可以创建新的文件描述符

$ zsh
$ exec 3>somefile
先进入目录，再查看，否则你可能不能得到正确的结果，然后再回到上一次的目录

```shell
cd /dev/fd/
ls -Al
cd -
```
**注意下面的命令>与&之间不应该有空格，如果有空格则会出错**

```shell
echo "this is test" >&3
cat somefile
exit
```


## 6.关闭文件描述符

如上面我们打开的3号文件描述符，可以使用如下操作将它关闭

```shell
exec 3>&-
cd /dev/fd
ls -Al
cd -
```
## 7.完全屏蔽命令的输出

在linux中有一个被成为“黑洞”的设备文件,所以导入它的数据都将被“吞噬”.

在类Unix系统中，/dev/null，或称空设备，是一个特殊的设备文件，它通常被用于丢弃不需要的输出流，或作为用于输入流的空文件，这些操作通常由重定向完成。读取它则会立即得到一个EOF。
我们可以利用设个/dev/null屏蔽命令的输出

```shell
cat file1 file2 1>/dev/null 2>&1
```
向上面这样的操作将使你得不到任何输出结果

## 8.使用xargs分割参数列表

xargs是一条Unix和类Unix操作系统的常用命令。它的作用是将参数列表转换成小块分段传递给其他命令，以避免参数列表过长的问题。
这个命令在有些时候十分有用，特别是当用来处理产生大量输出结果的命令如find,locate和grep的结果，详细用法请参看man文档

```shell
cut -d: -f1 < /etc/passwd | sort | xargs echo
```
上面这个命令用于将/etc/passwd文件按:分割取第一个字段排序后，使用echo命令生成一个列表